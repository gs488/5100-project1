<!DOCTYPE html>
<!DOCTYPE html>
<head>
    <meta charset="UTF-8" />
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>Project 1</title>
</head>
<body>
    <h3>
        INFO 3300 Project 1 <br />
        Grace Song gs488, Zhongkai Liu zl777, Jerry Xu lx46
    </h3>

    <div id="chartDiv"></div>
    <script>
        // svg setup
        const width = 800;
        const height = 500;
        const margins = { top: 10, right: 50, bottom: 30, left: 50 };
        const chartWidth = width - margins.right - margins.left;
        const chartHeight = height - margins.top - margins.bottom;
        const barWidth = 20;
        const skinnyBarWidth = 15;
        const barPadding = 5;

        // colors for four groups
        const colorISBachelors = "steelblue";
        const colorISMasters = "orange";
        const colorCSBachelors = "green";
        const colorCSMasters = "purple";

        // create svgs and charts
        const chartDiv = d3.select("#chartDiv");

        // chart 1
        chartDiv
            .append("h4")
            .text("Average Salary IS Bachelors vs. IS Masters");

        const svg1 = chartDiv
            .append("svg")
            .attr("id", "svg1")
            .attr("width", String(width))
            .attr("height", String(height));
        const chart1 = svg1
            .append("g")
            .attr("id", "chart1")
            .attr("class", "chart")
            .attr(
                "transform",
                "translate(" + margins.left + "," + margins.top + ")"
            );

        // chart 2
        chartDiv
            .append("h4")
            .text("Average Salary CS Bachelors vs. CS Masters");

        const svg2 = chartDiv
            .append("svg")
            .attr("id", "svg2")
            .attr("width", String(width))
            .attr("height", String(height));

        const chart2 = svg2
            .append("g")
            .attr("class", "chart")
            .attr(
                "transform",
                "translate(" + margins.left + "," + margins.top + ")"
            );

        // chart 3
        chartDiv
            .append("h4")
            .text("Average Salary CS Bachelors vs. IS Bachelors");

        const svg3 = chartDiv
            .append("svg")
            .attr("id", "svg3")
            .attr("width", String(width))
            .attr("height", String(height));

        const chart3 = svg3
            .append("g")
            .attr("class", "chart")
            .attr(
                "transform",
                "translate(" + margins.left + "," + margins.top + ")"
            );

        // chart 4

        chartDiv.append("h4").text("Average Salary CS Masters vs. IS Masters");

        const svg4 = chartDiv
            .append("svg")
            .attr("id", "svg4")
            .attr("width", String(width))
            .attr("height", String(height));

        const chart4 = svg4
            .append("g")
            .attr("class", "chart")
            .attr(
                "transform",
                "translate(" + margins.left + "," + margins.top + ")"
            );

        // chart 5
        chartDiv
            .append("h4")
            .text(
                "Average Salary IS Bachelors, IS Masters, CS Bachelors, and CS Masters"
            );

        const svg5 = chartDiv
            .append("svg")
            .attr("id", "svg5")
            .attr("width", String(width + 50))
            .attr("height", String(height));

        const chart5 = svg5
            .append("g")
            .attr("class", "chart")
            .attr(
                "transform",
                "translate(" + margins.left + "," + margins.top + ")"
            );

        // chart 6
        chartDiv
            .append("h4")
            .text("CS vs IS Enrollment");

        const svg6 = chartDiv
            .append("svg")
            .attr("id", "svg6")
            .attr("width", String(width))
            .attr("height", String(height));
        const chart6 = svg6
            .append("g")
            .attr("id", "chart6")
            .attr("class", "chart")
            .attr(
                "transform",
                "translate(" + margins.left + "," + margins.top + ")"
            );

        // retrieve JSON file
        d3.json("./salaries.json").then(data => {
            // filter data into different groups
            const dataIS = data.filter(d => {
                return d["major"] === "IS";
            });

            const dataCS = data.filter(d => {
                return d["major"] === "CS";
            });

            const dataBachelors = data.filter(d => {
                return d["degree"] === "Bachelors";
            });

            const dataMasters = data.filter(d => {
                return d["degree"] === "Masters";
            });

            const dataISBachelors = data.filter(d => {
                return d["major"] === "IS" && d["degree"] === "Bachelors";
            });

            const dataISMasters = data.filter(d => {
                return d["major"] === "IS" && d["degree"] === "Masters";
            });

            const dataCSBachelors = data.filter(d => {
                return d["major"] === "CS" && d["degree"] === "Bachelors";
            });

            const dataCSMasters = data.filter(d => {
                return d["major"] === "CS" && d["degree"] === "Masters";
            });

            // function to calculate number of student in a certain location of a certain group
            let numberOfLocation = (dataGroup, location) => {
                let num = 0;
                dataGroup.forEach((d, i) => {
                    num += Number(d[location]);
                });
                return num;
            };

            // number of different locations of four groups
            const numISBachelorsNYC = numberOfLocation(dataISBachelors, "nyc");
            const numISBachelorsSF = numberOfLocation(dataISBachelors, "sf");
            const numISBachelorsTotal = numberOfLocation(
                dataISBachelors,
                "total"
            );

            const numCSBachelorsNYC = numberOfLocation(dataCSBachelors, "nyc");
            const numCSBachelorsSF = numberOfLocation(dataCSBachelors, "sf");
            const numCSBachelorsTotal = numberOfLocation(
                dataCSBachelors,
                "total"
            );

            const numISMastersNYC = numberOfLocation(dataISMasters, "nyc");
            const numISMastersSF = numberOfLocation(dataISMasters, "sf");
            const numISMastersTotal = numberOfLocation(dataISMasters, "total");
            const numCSMastersNYC = numberOfLocation(dataCSMasters, "nyc");
            const numCSMastersSF = numberOfLocation(dataCSMasters, "sf");
            const numCSMastersTotal = numberOfLocation(dataCSMasters, "total");

            // data for the donut chart
            const percentISBachelorsNYC =
                numISBachelorsNYC / numISBachelorsTotal;
            const percentISBachelorsSF = numISBachelorsSF / numISBachelorsTotal;
            const percentISBachelorsOther =
                1 - percentISBachelorsNYC - percentISBachelorsSF;

            const percentCSBachelorsNYC =
                numCSBachelorsNYC / numCSBachelorsTotal;
            const percentCSBachelorsSF = numCSBachelorsSF / numCSBachelorsTotal;
            const percentCSBachelorsOther =
                1 - percentCSBachelorsNYC - percentCSBachelorsSF;

            const percentISMastersNYC = numISMastersNYC / numISMastersTotal;
            const percentISMastersSF = numISMastersSF / numISMastersTotal;
            const percentISMastersOther =
                1 - percentISMastersNYC - percentISMastersSF;

            const percentCSMastersNYC = numCSMastersNYC / numCSMastersTotal;
            const percentCSMastersSF = numCSMastersSF / numCSMastersTotal;
            const percentCSMastersOther =
                1 - percentCSMastersNYC - percentCSMastersSF;

            // just console.log() to see the percentages
            // console.log(percentISBachelorsNYC);
            // console.log(percentISBachelorsSF);
            // console.log(percentISBachelorsOther);

            // console.log(percentCSBachelorsNYC);
            // console.log(percentCSBachelorsSF);
            // console.log(percentCSBachelorsOther);

            // console.log(percentISMastersNYC);
            // console.log(percentISMastersSF);
            // console.log(percentISMastersOther);

            // console.log(percentCSMastersNYC);
            // console.log(percentCSMastersSF);
            // console.log(percentCSMastersOther);

            // max of salary of different groups
            const salaryMax = d3.max(data, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxIS = d3.max(dataIS, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxCS = d3.max(dataCS, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxBachelors = d3.max(dataBachelors, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxMasters = d3.max(dataMasters, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxISBachelors = d3.max(dataISBachelors, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxISMasters = d3.max(dataISMasters, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxCSBachelors = d3.max(dataCSBachelors, d => {
                return Math.max(d["salary"]);
            });

            const salaryMaxCSMasters = d3.max(dataCSMasters, d => {
                return Math.max(d["salary"]);
            });

            // scales
            const yearScale = d3
                .scaleTime()
                .domain([new Date(2011, 6, 1), new Date(2018, 6, 1)])
                .range([0, chartWidth]);

            const salaryScaleIS = d3
                .scaleLinear()
                .domain([50000, 90000])
                .range([chartHeight, 0]);

            const salaryScaleCS = d3
                .scaleLinear()
                .domain([80000, 120000])
                .range([chartHeight, 0]);

            const salaryScaleBachelors = d3
                .scaleLinear()
                .domain([50000, 110000])
                .range([chartHeight, 0]);

            const salaryScaleMasters = d3
                .scaleLinear()
                .domain([80000, 120000])
                .range([chartHeight, 0]);

            const salaryScaleAllData = d3
                .scaleLinear()
                .domain([50000, 120000])
                .range([chartHeight, 0]);

            const enrollmentScale = d3
                .scaleLinear()
                .domain([0, 3000])
                .range([chartHeight, 0]);

            // Axises
            const yearAxis = d3
                .axisBottom(yearScale)
                .tickFormat(d3.timeFormat("%Y"))
                .tickSize(0)
                .tickPadding(10);

            const salaryAxisIS = d3.axisLeft(salaryScaleIS).ticks(6);

            const salaryAxisCS = d3.axisLeft(salaryScaleCS);

            const salaryAxisBachelors = d3.axisLeft(salaryScaleBachelors);

            const salaryAxisMasters = d3.axisLeft(salaryScaleMasters);

            const salaryAxisAllData = d3.axisLeft(salaryScaleAllData);

            const enrollmentAxis = d3.axisLeft(enrollmentScale);

            // salary text on bar
            let salaryText = svg1
                .append("text")
                .attr(
                    "transform",
                    "translate(" + margins.left + ", " + margins.top + ")"
                )
                .attr("id", "salary_text")
                .attr("text-anchor", "middle")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 0);

            // ------ Chart 1, IS Bachelors vs. IS Masters ----
            // append axises
            svg1.append("g")
                .attr("class", "x axis")
                .attr(
                    "transform",
                    "translate(" +
                        margins.left +
                        ", " +
                        (margins.top + chartHeight) +
                        ")"
                )
                .call(yearAxis);

            svg1.append("g")
                .attr("class", "y axis")
                .attr(
                    "transform",
                    "translate(" + margins.left + ", " + margins.top + ")"
                )
                .call(salaryAxisIS);

            // draw Chart 1
            dataIS.forEach((d, i) => {
                let x = yearScale(new Date(d["classyear"], 0, 1));
                let fill = "";
                if (d["degree"] === "Bachelors") {
                    x -= barWidth + barPadding / 2;
                    fill = colorISBachelors;
                } else {
                    x += barPadding / 2;
                    fill = colorISMasters;
                }
                let y = salaryScaleIS(d["salary"]);

                let bar = chart1
                    .append("rect")
                    .attr("width", barWidth)
                    .attr("height", chartHeight - y)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("year", d["classyear"])
                    .attr("major", d["major"])
                    .attr("degree", d["degree"])
                    .style("fill", fill)
                    .style("stroke", "none");
            });

            // add legend for char 1
            let legend1 = svg1
                .append("g")
                .attr("id", "legend1")
                .attr("class", "legend")
                .attr(
                    "transform",
                    "translate(" + (chartWidth + 30) + "," + margins.top + ")"
                );

            legend1
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 0)
                .style("fill", colorISBachelors)
                .text("IS Bachelors");

            legend1
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 20)
                .style("fill", colorISMasters)
                .text("IS Masters");

            // ------ Chart 2, CS Bachelors vs. CS Masters ----
            // create axises
            svg2.append("g")
                .attr("class", "x axis")
                .attr(
                    "transform",
                    "translate(" +
                        margins.left +
                        ", " +
                        (margins.top + chartHeight) +
                        ")"
                )
                .call(yearAxis);

            svg2.append("g")
                .attr("class", "y axis")
                .attr(
                    "transform",
                    "translate(" + margins.left + ", " + margins.top + ")"
                )
                .call(salaryAxisCS);

            //create bars
            dataCS.forEach((d, i) => {
                let x = yearScale(new Date(d["classyear"], 0, 1));
                let fill = "";
                if (d["degree"] === "Bachelors") {
                    x -= barWidth + barPadding / 2;
                    fill = colorCSBachelors;
                } else {
                    x += barPadding / 2;
                    fill = colorCSMasters;
                }
                let y = salaryScaleCS(d["salary"]);

                let bar = chart2
                    .append("rect")
                    .attr("width", barWidth)
                    .attr("height", chartHeight - y)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("year", d["classyear"])
                    .attr("major", d["major"])
                    .attr("degree", d["degree"])
                    .style("fill", fill)
                    .style("stroke", "none");
            });

            // add legend for char 2
            let legend2 = svg2
                .append("g")
                .attr("id", "legend2")
                .attr("class", "legend")
                .attr(
                    "transform",
                    "translate(" + (chartWidth + 30) + "," + margins.top + ")"
                );

            legend2
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 0)
                .style("fill", colorCSBachelors)
                .text("CS Bachelors");

            legend2
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 20)
                .style("fill", colorCSMasters)
                .text("CS Masters");

            // ------ Chart 3: IS Bachelors vs. CS Bachelors
            svg3.append("g")
                .attr("class", "x axis")
                .attr(
                    "transform",
                    "translate(" +
                        margins.left +
                        ", " +
                        (margins.top + chartHeight) +
                        ")"
                )
                .call(yearAxis);

            svg3.append("g")
                .attr("class", "y axis")
                .attr(
                    "transform",
                    "translate(" + margins.left + ", " + margins.top + ")"
                )
                .call(salaryAxisBachelors);

            //create bars
            dataBachelors.forEach((d, i) => {
                let x = yearScale(new Date(d["classyear"], 0, 1));
                let fill = "";
                if (d["major"] === "CS") {
                    x += barPadding / 2;
                    fill = colorCSBachelors;
                } else {
                    x -= barWidth + barPadding / 2;
                    fill = colorISBachelors;
                }
                let y = salaryScaleBachelors(d["salary"]);

                let bar = chart3
                    .append("rect")
                    .attr("width", barWidth)
                    .attr("height", chartHeight - y)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("year", d["classyear"])
                    .attr("major", d["major"])
                    .attr("degree", d["degree"])
                    .style("fill", fill)
                    .style("stroke", "none");
            });

            // add legend for char 3
            let legend3 = svg3
                .append("g")
                .attr("id", "legend3")
                .attr("class", "legend")
                .attr(
                    "transform",
                    "translate(" + (chartWidth + 30) + "," + margins.top + ")"
                );

            legend3
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 0)
                .style("fill", colorISBachelors)
                .text("IS Bachelors");

            legend3
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 20)
                .style("fill", colorCSBachelors)
                .text("CS Bachelors");

            // ------ Chart 4, IS Masters vs. CS Masters ----

            svg4.append("g")
                .attr("class", "x axis")
                .attr(
                    "transform",
                    "translate(" +
                        margins.left +
                        ", " +
                        (margins.top + chartHeight) +
                        ")"
                )
                .call(yearAxis);

            svg4.append("g")
                .attr("class", "y axis")
                .attr(
                    "transform",
                    "translate(" + margins.left + ", " + margins.top + ")"
                )
                .call(salaryAxisMasters);

            //create bars
            dataMasters.forEach((d, i) => {
                let x = yearScale(new Date(d["classyear"], 0, 1));
                let fill = "";
                if (d["major"] === "CS") {
                    x += barPadding / 2;
                    fill = colorCSMasters;
                } else {
                    x -= barWidth + barPadding / 2;
                    fill = colorISMasters;
                }
                let y = salaryScaleMasters(d["salary"]);

                let bar = chart4
                    .append("rect")
                    .attr("width", barWidth)
                    .attr("height", chartHeight - y)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("year", d["classyear"])
                    .attr("major", d["major"])
                    .attr("degree", d["degree"])
                    .style("fill", fill)
                    .style("stroke", "none");
            });

            // add legend for char 4
            let legend4 = svg4
                .append("g")
                .attr("id", "legend4")
                .attr("class", "legend")
                .attr(
                    "transform",
                    "translate(" + (chartWidth + 30) + "," + margins.top + ")"
                );

            legend4
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 0)
                .style("fill", colorISMasters)
                .text("IS Masters");

            legend4
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 0)
                .attr("y", 20)
                .style("fill", colorCSMasters)
                .text("CS Masters");

            // ------ Chart 5, IS Bachelors, IS Masters, CS Bachelors, and CS Masters ----

            svg5.append("g")
                .attr("class", "x axis")
                .attr(
                    "transform",
                    "translate(" +
                        margins.left +
                        ", " +
                        (margins.top + chartHeight) +
                        ")"
                )
                .call(yearAxis);

            svg5.append("g")
                .attr("class", "y axis")
                .attr(
                    "transform",
                    "translate(" + margins.left + ", " + margins.top + ")"
                )
                .call(salaryAxisAllData);

            //create bars
            //bars for IS
            dataIS.forEach((d, i) => {
                let x = yearScale(new Date(d["classyear"], 0, 1));
                let fill = "";
                if (d["degree"] === "Bachelors") {
                    x -= skinnyBarWidth * 2 + barPadding * 1.5;
                    fill = colorISBachelors;
                } else {
                    x -= skinnyBarWidth + barPadding * 0.5;
                    fill = colorISMasters;
                }
                let y = salaryScaleAllData(d["salary"]);

                let bar = chart5
                    .append("rect")
                    .attr("width", skinnyBarWidth)
                    .attr("height", chartHeight - y)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("year", d["classyear"])
                    .attr("major", d["major"])
                    .attr("degree", d["degree"])
                    .style("fill", fill)
                    .style("stroke", "none");
            });
            //bars for CS
            dataCS.forEach((d, i) => {
                let x = yearScale(new Date(d["classyear"], 0, 1));
                let fill = "";
                if (d["degree"] === "Bachelors") {
                    x += barPadding * 0.5;
                    fill = colorCSBachelors;
                } else {
                    x += skinnyBarWidth + barPadding * 1.5;
                    fill = colorCSMasters;
                }
                let y = salaryScaleAllData(d["salary"]);

                let bar = chart5
                    .append("rect")
                    .attr("width", skinnyBarWidth)
                    .attr("height", chartHeight - y)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("year", d["classyear"])
                    .attr("major", d["major"])
                    .attr("degree", d["degree"])
                    .style("fill", fill)
                    .style("stroke", "none");
            });

            // add legend for chart 5
            let legend5 = svg5
                .append("g")
                .attr("id", "legend5")
                .attr("class", "legend")
                .attr(
                    "transform",
                    "translate(" + (chartWidth + 30) + "," + margins.top + ")"
                );

            legend5
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 15)
                .attr("y", 0)
                .style("fill", colorISBachelors)
                .text("IS Bachelors");

            legend5
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 15)
                .attr("y", 20)
                .style("fill", colorISMasters)
                .text("IS Masters");

            legend5
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 15)
                .attr("y", 40)
                .style("fill", colorCSBachelors)
                .text("CS Bachelors");

            legend5
                .append("text")
                .attr("text-anchor", "start")
                .attr("alignment-baseline", "hanging")
                .attr("font-size", "12px")
                .attr("x", 15)
                .attr("y", 60)
                .style("fill", colorCSMasters)
                .text("CS Masters");

            // ------ Chart 6, CS vs IS enrollment line graph ----

            svg6.append("g")
                .attr("class", "x axis")
                .attr(
                    "transform",
                    "translate(" +
                        margins.left +
                        ", " +
                        (margins.top + chartHeight) +
                        ")"
                )
                .call(yearAxis);

            svg6.append("g")
                .attr("class", "y axis")
                .attr(
                    "transform",
                    "translate(" + margins.left + ", " + margins.top + ")"
                )
                .call(enrollmentAxis);
/*
            var line = d3.svg.line()
                .x(function(d){ return x(d.classyear); })
                .y(function(d) {return y(d.total); });
                */
/*
//loop through data
            dataCS.forEach((d, i) => {
                d.date = d["classyear"];
                d.total = +d["total"]


                let x = yearScale(new Date(d["classyear"], 0, 1));
                let fill = "";
                if (d["degree"] === "Bachelors") {
                    x -= skinnyBarWidth * 2 + barPadding * 1.5;
                    fill = colorCSBachelors;
                } else {
                    x -= skinnyBarWidth + barPadding * 0.5;
                    fill = colorCSMasters;
                }

            });*/




        });
    </script>
</body>
